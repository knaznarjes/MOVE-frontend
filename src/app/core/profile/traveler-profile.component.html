<!-- traveler-profile.component.html -->
<div class="profile-container">
    <div class="loading-overlay" *ngIf="isLoading">
      <mat-spinner></mat-spinner>
    </div>

    <mat-card>
      <mat-card-header>
        <mat-card-title>Traveler Profile</mat-card-title>
        <mat-card-subtitle>Manage your personal information and preferences</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <!-- Profile Photo -->
        <div class="profile-photo-section">
          <div class="profile-image-container">
            <img [src]="profileImageSrc || 'assets/images/default-avatar.png'" alt="Profile photo" class="profile-image">
            <button mat-mini-fab color="primary" class="upload-button" (click)="fileInput.click()">
              <mat-icon>photo_camera</mat-icon>
            </button>
            <input hidden type="file" #fileInput (change)="onFileSelected($event)" accept="image/*">
          </div>
          <button mat-raised-button color="primary" [disabled]="!selectedFile || isUpdating" (click)="uploadProfilePhoto()">
            <mat-icon>cloud_upload</mat-icon>
            Save Photo
          </button>
        </div>

        <!-- Personal Information -->
        <div class="form-section">
          <h3>Personal Information</h3>
          <form [formGroup]="profileForm" (ngSubmit)="updateProfile()">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Full Name</mat-label>
              <input matInput formControlName="fullName" placeholder="Your full name">
              <mat-error *ngIf="profileForm.get('fullName')?.hasError('required')">
                Full name is required
              </mat-error>
              <mat-error *ngIf="profileForm.get('fullName')?.hasError('minlength')">
                The name must be at least 3 characters long
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Email</mat-label>
              <input matInput formControlName="email" placeholder="Your email">
              <mat-hint>Email cannot be changed</mat-hint>
            </mat-form-field>

            <div class="form-actions">
              <button mat-raised-button color="primary" type="submit" [disabled]="profileForm.invalid || isUpdating">
                <mat-icon>save</mat-icon>
                Update Profile
              </button>
            </div>
          </form>
        </div>

        <!-- Travel Preferences -->
        <div class="form-section">
          <h3>Travel Preferences</h3>
          <form [formGroup]="preferencesForm" (ngSubmit)="updatePreferences()">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Preferred Category</mat-label>
              <mat-select formControlName="category">
                <mat-option value="BEACH">Beach</mat-option>
                <mat-option value="MOUNTAIN">Mountain</mat-option>
                <mat-option value="COUNTRYSIDE">Countryside</mat-option>
                <mat-option value="CITY">City</mat-option>
                <mat-option value="CULTURAL">Cultural</mat-option>
              </mat-select>
              <mat-error *ngIf="preferencesForm.get('category')?.hasError('required')">
                Please select a category
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Priority</mat-label>
              <mat-select formControlName="priority">
                <mat-option value="PRICE">Price</mat-option>
                <mat-option value="COMFORT">Comfort</mat-option>
                <mat-option value="PROXIMITY">Proximity</mat-option>
                <mat-option value="ATTRACTIONS">Attractions</mat-option>
              </mat-select>
              <mat-error *ngIf="preferencesForm.get('priority')?.hasError('required')">
                Please select a priority
              </mat-error>
            </mat-form-field>

            <div class="form-actions">
              <button mat-raised-button color="accent" type="submit" [disabled]="preferencesForm.invalid || isUpdating">
                <mat-icon>bookmark</mat-icon>
                Save Preferences
              </button>
            </div>
          </form>
        </div>

        <!-- Account Settings -->
        <div class="form-section">
          <h3>Account Settings</h3>
          <button mat-raised-button color="warn" (click)="deleteAccount()">
            <mat-icon>delete_forever</mat-icon>
            Delete My Account
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
